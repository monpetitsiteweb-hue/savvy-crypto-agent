name: Deploy to DEV

on:
  push:
    branches:
      - dev

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Supabase CLI
        run: |
          npm install -g supabase

      - name: Link to DEV Supabase project
        run: |
          supabase link --project-ref ${{ secrets.SB_PROJECT_REF_DEV }}
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}

      - name: Deploy Edge Functions to DEV
        run: |
          supabase functions deploy --no-verify-jwt
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}

      - name: Deployment Summary
        run: |
          echo "‚úÖ Edge Functions deployed to DEV project: ${{ secrets.SB_PROJECT_REF_DEV }}"
          echo "üîó Functions URL: https://${{ secrets.SB_PROJECT_REF_DEV }}.supabase.co/functions/v1/"
          echo ""
          echo "‚ö†Ô∏è  Remember to set runtime secrets in Supabase UI:"
          echo "  - SERVER_SIGNER_MODE=webhook"
          echo "  - DEV_SIGNER_WEBHOOK_URL=https://your-dev-signer.railway.app/sign"
          echo "  - DEV_SIGNER_WEBHOOK_AUTH=Bearer your-secret"
          echo "  - RPC_URL_8453=https://mainnet.base.org"
          echo "  - ZEROEX_API_KEY=your-api-key"
          echo "  - SB_URL, SB_SERVICE_ROLE"
          echo "  - Optional: MAX_TX_VALUE_WEI, NOTIFICATION_WEBHOOK_URL"
